var app=angular.module("FoundersMapQuest",["leaflet-directive","ngRoute"]);app.config(function($routeProvider){$routeProvider.when("/",{controller:"MainController",templateUrl:"views/main.html"}).when("/map",{controller:"MapController",templateUrl:"views/map.html"}).otherwise({templateUrl:"views/main.html"})}),app.config(function($logProvider){$logProvider.debugEnabled(!1)}),smoothScroll.init({selector:"[data-scroll]",selectorHeader:"[data-scroll-header]",speed:500,easing:"easeInQuart",offset:0,updateURL:!0,callback:function(anchor,toggle){}});
app.controller("MainController",["$scope",function($scope){$scope.heading="Homepage"}]);
app.controller("MapController",["$scope","$timeout","leafletData",function($scope,$timeout,leafletData){angular.extend($scope,{mapCenter:{lat:37.3403188,lng:-122.0581469,zoom:4},defaults:{tileLayer:"http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png",zoomControlPosition:"topright",tileLayerOptions:{opacity:.9,detectRetina:!0,reuseTiles:!0},scrollWheelZoom:!1},layers:{baselayers:{openStreetMap:{name:"OpenStreetMap",type:"xyz",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}},overlays:{}},headingKeys:["id","company","founder","city","country","zip","street","photo","homepage","lat","lng"],heading:{},markers:{},bounds:{},showMap:!1,csvData:"",delimiter:",",startups:[],dataLat:"Garage Latitude",dataLng:"Garage Longitude",sortType:"-id",sortReverse:!0,searchStartup:""}),$scope.$watch("showMap",function(value){value===!0&&leafletData.getMap().then(function(map){$timeout(function(){map.invalidateSize()},300)})}),$scope.$watchGroup(["delimiter","csvData","dataLat","dataLng"],function(){var lines,data,indexLat,indexLng;$scope.startups=[],lines=$scope.csvData.split("\n"),$scope.csvData.length&&(toggleVisibility("#delimiter","show"),toggleVisibility("#tableMarkers","show")),$scope.firstRow=isTabDelimited(lines[0],$scope.delimiter);for(var i=0,l=$scope.headingKeys.length;i<l;i++)$scope.heading[$scope.headingKeys[i]]=$scope.firstRow[i];$scope.firstRow.length>1&&(indexLat=$scope.firstRow.indexOf($scope.dataLat),indexLng=$scope.firstRow.indexOf($scope.dataLng));for(var i=1,l=lines.length;i<l;i++)line=lines[i],data=isTabDelimited(line,$scope.delimiter),$scope.startups.push({id:data[0],company:data[1],founder:data[2],city:data[3],country:data[4],zip:data[5],street:data[6],photo:data[7],homepage:data[8],lat:parseFloat(data[indexLat]),lng:parseFloat(data[indexLng])});$scope.startups.length&&(toggleVisibility("#coords","show"),toggleVisibility("#formSearch","show"),isNaN($scope.startups[0].lat)||isNaN($scope.startups[0].lng)||($scope.sortBy=function(sortType){$scope.sortReverse=$scope.sortType===sortType&&!$scope.sortReverse,$scope.sortType=sortType},$scope.showMap=!0,$scope.markers=dataToMarkers($scope.startups),$scope.$watch(["markers"],function(){updateMap(leafletData);for(var i=0,l=$scope.startups.length;i<l;i++)$scope.layers.overlays[$scope.startups[i].id]={type:"group",name:$scope.startups[i].company,visible:!0}})))})}]);
var dataToMarkers=function(data){for(var markers={},i=0,l=data.length;i<l;i++)place={layer:data[i].id,lat:data[i].lat,lng:data[i].lng},markers[data[i].id]=place;return markers},toggleVisibility=function(tag,action){var e=document.querySelector(tag);"show"==action?e.removeAttribute("hidden"):e.setAttribute("hidden","hidden")},updateMap=function(data){var _leafletMap=null;data.getMap().then(function(leafletMap){_leafletMap=leafletMap,data.getMarkers().then(function(markers){function getBoundsRecursive(obj){for(key in obj)obj[key].getLatLng?bounds?bounds.extend(obj[key].getLatLng()):bounds=L.latLngBounds(obj[key].getLatLng(),obj[key].getLatLng()):getBoundsRecursive(obj[key])}var bounds=null;getBoundsRecursive(markers),_leafletMap.fitBounds(bounds,{padding:[50,50]})})})},isTabDelimited=function(data,delimiter){return"t"==delimiter?data.split(/\t+/):data.split(delimiter)};